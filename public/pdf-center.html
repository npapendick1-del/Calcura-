<!doctype html>
<html lang="de">
   <!-- Einheitliches Design laden -->
<link rel="stylesheet" href="style.css">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDF-Center</title>
  <style>
    :root{--txt:#0b1220;--muted:#6b7280;--card:#f8fafc;--brand:#2563eb;}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#fff;color:var(--txt)}
    header{padding:16px 20px;border-bottom:1px solid #eef2f7}
    header h1{margin:0;font-size:18px}
    main{max-width:1100px;margin:0 auto;padding:20px;display:grid;gap:16px}
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:12px;padding:14px}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    button{padding:10px 14px;border:0;border-radius:10px;background:var(--brand);color:#fff;cursor:pointer}
    .ghost{background:#e5e7eb;color:#111827}
    table{width:100%;border-collapse:collapse;background:#fff;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden}
    th,td{padding:10px;border-bottom:1px solid #edf0f4;text-align:left;font-size:14px}
    td.actions{white-space:nowrap}
    a.btn{display:inline-block;padding:8px 10px;border-radius:8px;background:#e5e7eb;color:#111827;text-decoration:none;margin-right:6px}
  </style>
</head>
<body>
  <header><h1>PDF-Center</h1></header>
  <main>
    <div class="card">
      <div class="actions">
        <a class="btn" href="/dashboard.html">← Zurück</a>
        <button id="refreshBtn">Aktualisieren</button>
      </div>
    </div>

    <div class="card">
      <table id="tbl">
        <thead>
          <tr>
            <th>Datei</th><th>Größe</th><th>Geändert</th><th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

  <script>
    const tbody = document.querySelector("#tbl tbody");
    const refreshBtn = document.getElementById("refreshBtn");

    function fmtSize(n){
      if(n >= 1024*1024) return (n/1024/1024).toFixed(1)+" MB";
      if(n >= 1024) return (n/1024).toFixed(1)+" KB";
      return n+" B";
    }
    function fmtDate(ms){
      const d = new Date(ms);
      return d.toLocaleString();
    }

    async function load(){
      tbody.innerHTML = "<tr><td colspan='4'>Lade…</td></tr>";
      const res = await fetch("/api/pdfs/list");
      const data = await res.json();
      const rows = (data.items||[]).map(it => `
        <tr>
          <td><a href="${it.url}" target="_blank">${it.name}</a></td>
          <td>${fmtSize(it.size)}</td>
          <td>${fmtDate(it.mtime)}</td>
          <td class="actions">
            <a class="btn" href="${it.url}" download>Download</a>
            <button class="ghost" onclick="delFile('${it.name}')">Löschen</button>
          </td>
        </tr>
      `).join("");
      tbody.innerHTML = rows || "<tr><td colspan='4'>Keine PDFs gefunden.</td></tr>";
    }

    async function delFile(name){
      if(!confirm(`„${name}“ wirklich löschen?`)) return;
      const res = await fetch(`/api/pdfs?name=${encodeURIComponent(name)}`, { method: "DELETE" });
      if(!res.ok){ alert("Löschen fehlgeschlagen"); return; }
      load();
    }
    window.delFile = delFile;

    refreshBtn.onclick = load;
    load();
  </script>
</body>
</html>
