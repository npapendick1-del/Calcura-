<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PDF-Center</title>
<style>
:root{--txt:#0b1220;--muted:#6b7280;--card:#f8fafc;--brand:#2563eb}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--txt)}
header{padding:16px 20px;border-bottom:1px solid #eef2f7;display:flex;gap:12px;align-items:center}
header h1{margin:0;font-size:18px}
.back-btn{display:inline-block;background:#e5e7eb;color:#111827;padding:6px 12px;border-radius:8px;text-decoration:none}
.back-btn:hover{background:#d1d5db}
main{max-width:1100px;margin:0 auto;padding:18px;display:grid;gap:16px}
.card{background:var(--card);border:1px solid #e5e7eb;border-radius:12px;padding:14px}
table{width:100%;border-collapse:collapse;background:#fff;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden}
th,td{padding:10px;border-bottom:1px solid #edf0f4;text-align:left;font-size:14px}
.actions button{padding:6px 10px;border:0;border-radius:8px;cursor:pointer}
.btn{background:var(--brand);color:#fff}
.ghost{background:#e5e7eb;color:#111827}
.empty{color:var(--muted)}
</style>
</head>
<body>
<header>
  <a href="/dashboard.html" class="back-btn">← Zurück zum Dashboard</a>
  <h1>PDF-Center</h1>
</header>
<main>
  <div class="card">
    <table id="tbl">
      <thead><tr><th>Datei</th><th>Größe</th><th>Geändert</th><th></th></tr></thead>
      <tbody><tr><td colspan="4">Lade…</td></tr></tbody>
    </table>
  </div>
</main>
<script>
const tbody = document.querySelector("#tbl tbody");
function fmtSize(b){ if(b<1024) return b+" B"; if(b<1024*1024) return (b/1024).toFixed(1)+" KB"; return (b/1024/1024).toFixed(1)+" MB"; }
function fmtDate(ms){ try{ return new Date(ms).toLocaleString("de-DE"); }catch{ return "—"; } }
async function load(){
  try{
    const res = await fetch("/api/pdfs/list");
    if(!res.ok){ tbody.innerHTML = `<tr><td colspan="4">Fehler beim Laden (${res.status})</td></tr>`; return; }
    const data = await res.json();
    const items = data?.items || [];
    if(!items.length){ tbody.innerHTML = `<tr><td colspan="4" class="empty">Noch keine PDFs gespeichert. Erzeuge zuerst ein Angebot und exportiere es.</td></tr>`; return; }
    tbody.innerHTML = items.map(it=>`
      <tr>
        <td><a href="${it.url}" download>${it.name}</a></td>
        <td>${fmtSize(it.size)}</td>
        <td>${fmtDate(it.mtime)}</td>
        <td class="actions">
          <button class="ghost" onclick="open('${it.url}','_blank')">Ansehen</button>
          <button class="btn" onclick="download('${it.url}')">Download</button>
          <button class="ghost" onclick="delFile('${encodeURIComponent(it.name)}')">Löschen</button>
        </td>
      </tr>
    `).join("");
  }catch(e){
    tbody.innerHTML = `<tr><td colspan="4">Fehler beim Laden</td></tr>`;
  }
}
function download(url){
  const a = document.createElement("a");
  a.href = url; a.download = ""; document.body.appendChild(a); a.click(); a.remove();
}
async function delFile(name){
  if(!confirm("Datei wirklich löschen?")) return;
  const res = await fetch(`/api/pdfs?name=${name}`, { method: "DELETE" });
  if(!res.ok){ alert("Löschen fehlgeschlagen"); return; }
  load();
}
load();
</script>
</body>
</html>
